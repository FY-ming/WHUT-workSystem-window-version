# WHUT国旗班执勤管理系统 - 详细使用说明

## 📋 目录
1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [完整操作流程](#完整操作流程)
4. [功能详解](#功能详解)
5. [异常情况处理](#异常情况处理)
6. [常见问题FAQ](#常见问题faq)

---

## 系统概述

### 系统用途
本系统专为WHUT国旗班设计，用于：
- 管理队员基本信息（姓名、联系方式、组别等）
- 记录队员空闲时间安排
- 自动生成每周执勤排班表
- 导出格式化的Excel执勤表
- 保存和查看历史排班记录

### 系统特点
- **自动排班**：根据队员空闲时间和执勤次数智能分配
- **数据加密**：队员信息采用加密存储，保护隐私
- **历史记录**：自动保存每次排班结果，支持回溯
- **智能规则**：支持交接规则、监督模式等多种排班策略

---

## 快速开始

### 首次使用流程（5步）

#### 第1步：启动系统
- 双击运行 `WHUT国仪执勤系统.exe`
- 系统会自动创建 `data` 文件夹用于存储数据

#### 第2步：添加队员
1. 切换到【队员管理】标签页
2. 在左侧选择组别（一组/二组/三组/四组）
3. 点击【添加组员】按钮
4. 在右侧填写队员基本信息

#### 第3步：设置空闲时间
1. 点击左侧队员名字选中该队员
2. 在右侧【出勤安排】区域勾选该队员可以执勤的时间段
3. 或使用【导入空闲时间】功能批量导入

#### 第4步：执行排班
1. 切换到【值周管理】标签页
2. 选择排班模式（常规模式/监督模式等）
3. 点击【排班】按钮
4. 查看生成的排班表和统计信息

#### 第5步：导出表格
1. 点击【导出表格】按钮
2. 选择保存位置和文件名
3. 等待导出完成（会显示进度提示）

---

## 完整操作流程

### 一、队员管理模块

#### 1.1 添加新队员

**操作步骤：**
1. 进入【队员管理】标签页
2. 在左侧工具栏选择目标组别（一组/二组/三组/四组）
3. 点击【添加组员】按钮
4. 系统会自动创建一个"未命名队员X"的标签
5. 点击该标签，在右侧填写详细信息：
   - **姓名**：队员真实姓名（必填，同组内不能重名）
   - **性别**：男/女
   - **所属组别**：一组/二组/三组/四组
   - **年级**：大一/大二/大三
   - **联系电话**：11位手机号
   - **籍贯**：省份+城市
   - **民族**：如"汉族"
   - **学院**：如"计算机科学与技术学院"
   - **班级**：如"计科2201"
   - **宿舍**：如"东院12栋301"
   - **生日**：格式如"2005-01-15"

**注意事项：**
- 姓名不能与同组其他队员重复
- 修改信息后会自动保存
- 总执勤次数由系统自动统计，不可手动修改

#### 1.2 设置队员空闲时间

**方法一：手动设置**
1. 点击左侧队员名字选中该队员
2. 在右侧【出勤安排】区域：
   - 勾选该队员**可以**执勤的时间段
   - 不勾选表示该时间段**不可用**
3. 可使用【全选】按钮快速选择某天的所有时间
4. 可使用【全部可用】/【全部不可用】快速设置

**方法二：批量导入（推荐）**
1. 准备Excel或CSV文件，格式如下：

| 姓名 | 组别 | 周一升旗南鉴湖 | 周一升旗东西院 | ... | 周五降旗东西院 |
|------|------|----------------|----------------|-----|----------------|
| 张三 | 1    | 1              | 1              | ... | 0              |
| 李四 | 2    | 0              | 1              | ... | 1              |

   - 组别：1/2/3/4 表示一组/二组/三组/四组
   - 时间列：1表示可用，0表示不可用
   - 共20列时间：周一到周五，每天4个时段（升旗南鉴湖、升旗东西院、降旗南鉴湖、降旗东西院）

2. 点击【导入空闲时间】按钮
3. 选择准备好的文件
4. 系统会自动匹配姓名和组别，更新队员空闲时间
5. 导入完成后会显示成功和失败的数量

**注意事项：**
- 导入文件中的姓名和组别必须与系统中已存在的队员完全匹配
- 导入会覆盖原有的空闲时间设置
- 建议先导出一份模板文件作为参考

#### 1.3 设置组别执勤状态

**操作步骤：**
1. 在左侧工具栏找到目标组别
2. 勾选/取消勾选【X组是否值周】按钮
   - **勾选**：该组所有队员参与排班
   - **不勾选**：该组所有队员不参与排班

**使用场景：**
- 某组整体轮休时，取消勾选该组
- 某组有特殊任务无法执勤时
- 默认所有组都勾选

#### 1.4 修改队员信息

**操作步骤：**
1. 点击左侧队员名字选中该队员
2. 在右侧直接修改信息
3. 修改完成后，点击其他位置或按Tab键，系统自动保存

**特殊说明：**
- **修改组别**：在【所属组别】下拉框中选择新组别，队员会自动转移到新组
- **修改姓名**：新姓名不能与目标组中已有队员重名
- **总执勤次数**：只读，由系统自动统计，不可手动修改

#### 1.5 删除队员

**操作步骤：**
1. 在左侧点击要删除的队员名字
2. 点击【删除组员】按钮
3. 在确认对话框中点击【是】

**注意事项：**
- 删除操作不可恢复，请谨慎操作
- 删除后该队员的所有信息将永久丢失
- 建议在删除前先导出数据备份

---

### 二、值周管理模块

#### 2.1 选择排班模式

**常规模式（推荐）**
- 适用场景：日常排班
- 规则说明：
  - 遵循交接规则：周一南鉴湖降旗与周二南鉴湖升旗至少有1人重复
  - 平衡总次数：优先选择总执勤次数较少的队员
  - 性别平衡：避免3名女队员同时执勤（考虑西院左护身高要求）
  - 地点平衡：平衡南鉴湖和东西院的执勤次数

**监督模式**
- 适用场景：大一新队员刚开始执勤的前1-2个月
- 规则说明：
  - 每个时段至少有1名非大一队员带队
  - 确保任务顺利完成
  - 其他规则同常规模式

**东西院周一升周五降模式**
- 适用场景：期末考试周，减轻队员负担
- 规则说明：
  - 东西院只在周一升旗和周五降旗执勤
  - 南鉴湖保持正常执勤
  - 其他规则同常规模式

**自定义模式（暂未实现）**
- 当前版本不可用

#### 2.2 执行排班

**操作步骤：**
1. 确认队员信息和空闲时间已设置完成
2. 确认至少有12名队员可以参与排班
3. 选择排班模式
4. 点击【排班】按钮
5. 等待排班完成（通常1-2秒）
6. 查看排班结果：
   - 上方表格显示具体排班安排
   - 下方文本框显示统计信息和警告信息

**排班结果说明：**
- 表格显示每个时段的3名执勤队员
- 统计信息包括：
  - 每名队员本周执勤次数
  - 每名队员总执勤次数
  - 南鉴湖累计次数
  - 东西院累计次数
- 警告信息（如有）：
  - 某时段无法满足交接规则
  - 某时段人员不足
  - 其他异常情况

**注意事项：**
- 排班前请确保至少有12名可用队员
- 排班会自动增加队员的总执勤次数
- 如果对结果不满意，可以点击【恢复排班】重新排班

#### 2.3 查看历史记录

**操作步骤：**
1. 点击【查看历史记录】按钮
2. 在弹出的对话框中查看所有历史排班记录
3. 每条记录包括：
   - 排班时间
   - 排班模式
   - 排班表内容
   - 统计信息

**恢复历史记录：**
1. 在历史记录对话框中选择要恢复的记录
2. 点击【恢复此记录】按钮
3. 系统会恢复该记录的排班表和队员信息
4. 可以基于恢复的记录重新导出表格

**注意事项：**
- 历史记录会自动保存，无需手动操作
- 恢复历史记录会覆盖当前的排班表
- 恢复后可以重新导出表格

#### 2.4 导出表格

**操作步骤：**
1. 完成排班后，点击【导出表格】按钮
2. 在文件保存对话框中：
   - 选择保存位置
   - 输入文件名（如"第10周升降旗.xlsx"）
   - 确认文件格式为 `.xlsx`
3. 点击【保存】
4. 等待导出完成（显示进度提示）
5. 导出成功后会弹出提示框

**导出的Excel文件包含两个工作表：**

**工作表1：统计信息**
- 每名队员的本周执勤次数
- 每名队员的总执勤次数
- 南鉴湖和东西院累计次数
- 警告信息（如有）

**工作表2：排班表**
- 格式化的执勤表格
- 包含周一到周五的所有时段
- 自动设置字体、颜色、边框等格式
- 可直接打印或分享

**注意事项：**
- 导出前请确保Excel文件未被其他程序打开
- 如果文件已存在，会提示是否覆盖
- 导出过程中请勿关闭程序
- 导出成功后，排班按钮会被禁用，防止重复排班

#### 2.5 恢复排班

**使用场景：**
- 导出表格后想重新排班
- 对当前排班结果不满意
- 需要调整队员信息后重新排班

**操作步骤：**
1. 点击【恢复排班】按钮
2. 排班按钮重新启用
3. 导出表格按钮被禁用
4. 可以重新执行排班操作

**注意事项：**
- 恢复排班不会撤销已增加的总执勤次数
- 如需撤销次数，请使用历史记录功能

#### 2.6 导入空闲时间（值周管理界面）

**操作步骤：**
1. 在值周管理界面点击【导入空闲时间】按钮
2. 功能与队员管理界面的导入功能相同
3. 方便在排班前快速更新队员空闲时间

---

## 功能详解

### 排班算法说明

#### 基本原则
1. **空闲时间优先**：只从可用队员中选择
2. **次数平衡**：优先选择总执勤次数少的队员
3. **地点平衡**：平衡南鉴湖和东西院的执勤次数
4. **性别平衡**：避免3名女队员同时执勤

#### 交接规则
- 周一南鉴湖降旗与周二南鉴湖升旗至少有1人重复
- 减少旗帜交接工作量
- 如果无法满足，会发出警告并选择常规人员

#### 监督规则（监督模式）
- 每个时段至少有1名非大一队员
- 确保新队员有经验丰富的队员带队
- 适用于新学期开始的1-2个月

### 数据存储说明

#### 文件位置
- 队员数据：`./data/data.dat`（加密文件）
- 历史记录：`./data/schedule_history.dat`（加密文件）
- 旧版数据：`./data/data.txt`（明文，仅用于兼容）

#### 数据安全
- 所有数据采用加密存储
- 自动备份机制
- 关闭程序时自动保存

#### 数据迁移
- 首次运行会自动将旧格式转换为新格式
- 转换后旧文件仍保留，可手动删除

---

## 异常情况处理

### 1. 排班失败

#### 问题：点击排班按钮后提示"现在国旗班12个队员都凑不出来了吗:("

**原因分析：**
- 可用队员数量不足12人
- 某些组未勾选"是否值周"
- 队员空闲时间设置过少

**解决方案：**
1. 检查每个组的"是否值周"按钮是否勾选
2. 检查队员的空闲时间设置：
   - 点击每个队员，查看出勤安排
   - 确保每个队员至少有几个时段可用
3. 如果队员确实不足，考虑：
   - 添加新队员
   - 调整某些队员的空闲时间
   - 使用"东西院周一升周五降"模式减少需求

#### 问题：排班表中某些时段显示警告信息

**原因分析：**
- 该时段可用队员不足3人
- 无法满足交接规则
- 无法满足性别平衡要求

**解决方案：**
1. 查看警告信息，了解具体问题
2. 调整对应时段队员的空闲时间
3. 如果是交接规则问题，可以忽略（系统会自动选择其他队员）
4. 重新执行排班

### 2. 导出表格失败

#### 问题：点击导出表格后提示"文件被占用"

**原因分析：**
- 目标Excel文件正在被其他程序打开
- 通常是Excel程序打开了该文件

**解决方案：**
1. 关闭所有Excel窗口
2. 检查任务管理器中是否有Excel进程，如有则结束
3. 重新点击导出表格
4. 或者选择不同的文件名

#### 问题：导出过程中程序无响应

**原因分析：**
- Excel启动较慢
- 系统资源不足
- 导出过程正常，只是需要时间

**解决方案：**
1. 耐心等待，通常需要10-30秒
2. 观察进度提示框的变化
3. 不要点击其他按钮或关闭程序
4. 如果超过1分钟仍无响应，可以：
   - 结束程序（数据已自动保存）
   - 重新启动程序
   - 使用历史记录功能恢复排班表
   - 重新导出

#### 问题：导出后Excel文件无法打开

**原因分析：**
- 导出过程被中断
- Excel版本不兼容
- 文件损坏

**解决方案：**
1. 检查文件大小，如果为0KB说明导出失败
2. 使用历史记录功能恢复排班表
3. 重新导出到不同位置
4. 确保安装了Microsoft Excel 2007或更高版本

### 3. 数据丢失

#### 问题：关闭程序后数据丢失

**原因分析：**
- 选择了"不保存"选项
- 程序异常崩溃
- 数据文件被删除或损坏

**解决方案：**
1. 检查 `./data/` 文件夹是否存在
2. 检查是否有备份文件（如 `data-副本.dat`）
3. 如果有备份，将备份文件重命名为 `data.dat`
4. 如果没有备份，需要重新录入数据
5. 今后关闭程序时选择"保存"选项

#### 问题：队员信息修改后未保存

**原因分析：**
- 修改后立即关闭程序
- 选择了"不保存"选项

**解决方案：**
1. 修改信息后，点击其他位置确保自动保存
2. 关闭程序时选择"保存"选项
3. 养成定期保存的习惯（虽然系统会自动保存）

### 4. 队员管理问题

#### 问题：无法添加队员，提示"名字重复"

**原因分析：**
- 同组内已存在同名队员
- 姓名输入错误

**解决方案：**
1. 检查该组是否已有同名队员
2. 使用不同的姓名（如"张三1"、"张三2"）
3. 或者删除旧的同名队员后再添加

#### 问题：删除队员后信息显示区域仍显示该队员信息

**原因分析：**
- 这是正常现象，删除后信息区域会保留最后显示的内容
- 不影响实际数据

**解决方案：**
- 点击其他队员，信息区域会更新
- 或者切换到其他标签页再切换回来

#### 问题：修改队员组别后找不到该队员

**原因分析：**
- 队员已转移到新组别
- 需要在新组别中查找

**解决方案：**
1. 在左侧工具栏切换到新组别
2. 在新组别的队员列表中找到该队员
3. 这是正常的设计行为

### 5. 程序启动问题

#### 问题：双击程序无反应

**原因分析：**
- 程序已在运行（检查任务管理器）
- 缺少运行库
- 程序文件损坏

**解决方案：**
1. 检查任务管理器中是否已有该程序进程
2. 如果有，结束进程后重新启动
3. 如果没有，尝试以管理员身份运行
4. 重新安装程序

#### 问题：启动后提示缺少DLL文件

**原因分析：**
- 缺少Qt运行库
- 缺少Visual C++运行库

**解决方案：**
1. 使用安装包版本（已包含所有依赖）
2. 或者手动安装：
   - Qt 6.8.1运行库
   - Visual C++ 2015-2022运行库
3. 重新启动程序

### 6. Excel相关问题

#### 问题：导出时提示"无法启动Excel应用程序"

**原因分析：**
- 系统未安装Microsoft Excel
- Excel安装不完整
- Excel版本过旧

**解决方案：**
1. 安装Microsoft Excel 2007或更高版本
2. 修复Excel安装（控制面板 → 程序 → Microsoft Office → 修复）
3. 确保Excel可以正常启动
4. 重新尝试导出

#### 问题：导出的表格格式不正确

**原因分析：**
- Excel版本兼容性问题
- 导出过程被中断

**解决方案：**
1. 使用历史记录恢复排班表
2. 重新导出
3. 手动调整格式（通常不需要）

---

## 常见问题FAQ

### Q1：如何备份数据？
**A：** 
1. 找到程序目录下的 `data` 文件夹
2. 复制整个 `data` 文件夹到其他位置
3. 建议定期备份（如每周一次）

### Q2：如何恢复备份数据？
**A：**
1. 关闭程序
2. 将备份的 `data` 文件夹复制回程序目录
3. 覆盖原有的 `data` 文件夹
4. 重新启动程序

### Q3：可以在多台电脑上使用吗？
**A：**
可以，但需要手动同步数据：
1. 在电脑A上复制 `data` 文件夹
2. 将 `data` 文件夹复制到电脑B的程序目录
3. 在电脑B上启动程序

### Q4：如何导出队员信息？
**A：**
当前版本不支持直接导出队员信息，但可以：
1. 复制 `data` 文件夹作为备份
2. 或者手动记录队员信息

### Q5：排班结果可以手动调整吗？
**A：**
可以，有两种方式：
1. 在程序中重新排班（调整队员空闲时间后）
2. 导出Excel后手动修改表格内容

### Q6：总执勤次数统计不准确怎么办？
**A：**
总执勤次数由系统自动统计，如果不准确：
1. 检查历史记录，确认每次排班是否正确
2. 如果确实有误，可以联系开发者修复
3. 临时方案：在Excel表格中手动标注正确次数

### Q7：如何清空所有数据重新开始？
**A：**
1. 关闭程序
2. 删除 `data` 文件夹
3. 重新启动程序（会自动创建新的空数据文件）

### Q8：程序可以同时打开多个吗？
**A：**
可以，但不建议：
- 多个实例会共享同一个数据文件
- 可能导致数据冲突
- 建议只打开一个实例

### Q9：如何查看某个队员的历史执勤记录？
**A：**
当前版本不支持单独查看某个队员的历史记录，但可以：
1. 通过历史记录功能查看每次排班表
2. 手动统计该队员的执勤情况

### Q10：排班时如何确保某两个人不在同一时段？
**A：**
当前版本不支持此功能，临时方案：
1. 设置其中一人在该时段不可用
2. 或者导出后手动调整

---

## 使用技巧

### 技巧1：快速设置空闲时间
- 使用Excel批量编辑空闲时间，比手动勾选快得多
- 可以让队员自己填写Excel表格，然后统一导入

### 技巧2：定期备份
- 每周排班后备份一次 `data` 文件夹
- 可以避免数据丢失的风险

### 技巧3：使用历史记录
- 如果对排班结果不满意，可以查看历史记录
- 选择之前满意的排班结果重新导出

### 技巧4：合理设置空闲时间
- 建议每个队员至少有10个以上时段可用
- 这样排班算法才能有足够的选择空间

### 技巧5：分组管理
- 可以按年级或其他标准分组
- 方便管理和轮休安排

---

## 联系与反馈

### 遇到问题？
如果遇到本文档未涵盖的问题，请：
1. 仔细阅读错误提示信息
2. 尝试重启程序
3. 检查数据文件是否完整
4. 联系开发者（万明）

### 功能建议
如果您有任何功能建议或改进意见，欢迎反馈！

---

## 附录

### 附录A：文件结构说明
```
程序目录/
├── WHUT国仪执勤系统.exe    # 主程序
├── data/                     # 数据文件夹
│   ├── data.dat             # 队员信息（加密）
│   ├── schedule_history.dat # 历史记录（加密）
│   └── data.txt             # 旧版数据（兼容）
├── Qt6Core.dll              # Qt运行库
├── Qt6Gui.dll
├── Qt6Widgets.dll
└── ...                      # 其他依赖文件
```

### 附录B：快捷键说明
- 当前版本暂不支持快捷键
- 所有操作通过鼠标点击完成

### 附录C：版本历史
- v1.1.2：当前版本，增加历史记录功能
- v1.1.1：优化导出功能
- v1.1.0：增加数据加密
- v1.0：初始版本

---

**感谢使用WHUT国旗班执勤管理系统！**

*文档版本：v2.0*  
*最后更新：2026年1月*  
*作者：万明*









~~安装包有密码，懒得删了。~~
